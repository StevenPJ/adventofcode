name: Test Deployments

on:
  push:

jobs:
  deploy-one:
    name: Deploy my app
    runs-on: ubuntu-latest
    environment:
      name: prd
      url: https://github.com/one
    continue-on-error: true
    steps:
      - name: Deploy my app
        run: exit 1

  clean_up_deploy:
    runs-on: ubuntu-latest
    needs: [deploy-one]
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/replace-workflow-deployment
        with:
          ref: ${{ github.ref }}
          description: Deployment of master to prd
          environment: prd
          payload: '{"serviceName": "test-service", "namespace": "ssv"}'
          token: ${{ secrets.GITHUB_TOKEN }}


  deploy-test:
    name: Deploy my app
    runs-on: ubuntu-latest
    environment:
      name: prd
      url: https://github.com/test

    continue-on-error: true
    steps:
      - name: Deploy my app
        run: exit 1

  clean_up_deploy-2:
    runs-on: ubuntu-latest
    needs: [ deploy-test ]
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/replace-workflow-deployment
        with:
          ref: ${{ github.ref }}
          description: Deployment of master to prd
          environment: prd
          payload: '{"serviceName": "test-service", "namespace": "ssv"}'
          token: ${{ secrets.GITHUB_TOKEN }}